# =============================================================================
# GENERAL
# =============================================================================

# set-option -sa terminal-overrides ",xterm*:Tc"
set-environment -g TZ Europe/Paris

# Don't rename windows automatically
set-option -g allow-rename off


# =============================================================================
# PREFIX
# =============================================================================

# Remap prefix from C-b to C-a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Reload config with prefix + r
unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"


# =============================================================================
# PANES
# =============================================================================

# Split panes keeping current path (v = vertical divider | h = horizontal divider)
unbind '"'
unbind %
bind v split-window -h -c "#{pane_current_path}"
bind h split-window -v -c "#{pane_current_path}"


# =============================================================================
# MOUSE
# =============================================================================

set-option -g mouse on

bind -n WheelUpPane   if-shell -F -t = "#{mouse_any_flag}" \
    "send-keys -M" \
    "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane   select-pane -t= \; send-keys -M
bind -n C-WheelUpPane   select-pane -t= \; copy-mode -e \; send-keys -M

bind -T copy-mode-vi    C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-vi    C-WheelDownPane send-keys -X halfpage-down
bind -T copy-mode-emacs C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-emacs C-WheelDownPane send-keys -X halfpage-down


# =============================================================================
# COPY MODE
# =============================================================================

set -g mode-keys vi

# Enter copy mode with C-g
bind-key -n C-g copy-mode

# Vi-style selection and yank → clipboard principal (xclip)
bind -T copy-mode-vi v     send-keys -X begin-selection
bind -T copy-mode-vi y     send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# Copie automatique au relâchement de la souris → clipboard principal
# Fonctionne en copy-mode-vi (sélection active) et depuis la table root (sélection directe)
bind -T copy-mode-vi    MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -T copy-mode-emacs MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -n                 MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"


# =============================================================================
# PLUGINS
# =============================================================================

# Plugin manager — doit être déclaré en premier
set -g @plugin 'tmux-plugins/tpm'

# Thème Nord
set -g @plugin 'arcticicestudio/nord-tmux'

# Logging
set -g @plugin 'tmux-plugins/tmux-logging'

# Picker (fzf)
set -g @picker-fzf-options "--ansi --preview-window=right:50%:wrap"
run-shell ~/.tmux/tmux-picker/tmux-picker.tmux

# Fuzzback
run-shell ~/.tmux/tmux-fuzzback/fuzzback.tmux

# Initialize TPM — garder en dernière ligne
run '~/.tmux/plugins/tpm/tpm'
